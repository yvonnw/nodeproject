# it is not generated by node-gyp configure, it is created manually
CC = g++

#output dir
OUTDIR = ./build_me

#the module name
MODULE_NAME = hello.node

#target path
TARGET = $(OUTDIR)/$(MODULE_NAME)


objs = $(OUTDIR)/hello.o

CPPFLAGS = -shared -fPIC

LINKFLAGS = -shared -pthread -rdynamic -m64 -lpthread -W1,-soname=$(MODULE_NAME)

all: $(OUTDIR) $(objs)
	flock $(OUTDIR)/linker.lock $(CC) $(LINKFLAGS) -o $(TARGET) -W1,--start-group $(objs) -W1,--end-group

$(OUTDIR):
	mkdir $@

$(objs): $(OUTDIR)/%.o: %.cc 
	$(CC) -c $(CPPFLAGS) $< -o $@






