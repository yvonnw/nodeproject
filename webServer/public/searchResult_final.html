<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'><head><meta http-equiv='Content-Type' content='text/html; charset=gb2312'/>
<script type='text/javascript' src='jquery-3.2.1.min.js'></script>
<script>
$(document).ready(function(){	
	//$("#editS").click(function(){
	$("table td").click(function(){
		oldV=$(this).text();
		console.log('goto edit');
		//get the title of the recored that is about to change
		console.log($(this).siblings('th:eq(0)').text());
		var changedTitle = $(this).siblings('th:eq(0)').text();
		if ($(this).attr('bgcolor') == '#BEBEBE'){
			console.log('this is a story');
			var category = 'story';
		} 
		else {
			console.log('this is a task');
			var category = 'task';
		}

		//get the field that is about to changed
		//console.log($(this).siblings());
		//console.log($(this).prevUntil('th:eq(0)'));
		//console.log($(this).prevUntil('th:eq(0)').length);
		var prevLength = $(this).prevUntil('th:eq(0)').length;
		var field = '';
		switch(prevLength)
		{

		case 3:
			field = 'owner';
			break;
		case 2:
			field = 'priority';
			break;
		case 1:
			field = 'status';
			break;
		case 4:
			field = 'deadline';
			break;
		case 5:
			field = 'description';
			break;
		};
		console.log(field);
		//document.getElementById('hiddenField').value = field;

	  $(this).addClass('input').html('<input id="changed" name="changed" value="'+$(this).text()+'"/>').find('input').focus().blur(function(){	  
	 	console.log($(this).val());	 	
	 	//document.getElementById('hiddenvalue').value = $(this).val();
	 	var changedValue = $(this).val();
	 	console.log('changedValue='+changedValue);
	 	//console.log('hiddenvalue='+document.getElementById('hiddenvalue').value);	

	 	$.ajax({
	 		type: 'POST',
	 		url: '/saveChange',
	 		data:'changedTitle='+changedTitle+'&changedField='+field+'&changedValue='+changedValue+'&category='+category
	 	}); 

	  });

	});

	$("#delete").click(function(){
		console.log('goto delete');
		console.log($(this).siblings());
		console.log($(this).prevUntil('th:eq(0)'));
		console.log($(this).siblings('th:eq(0)').text());
		var deleteTitle = $(this).siblings('th:eq(0)').text();
		if ($(this).attr('bgcolor') == '#BEBEBE'){
			console.log('this is a story');
			var category = 'story';
		} 
		else {
			console.log('this is a task');
			var category = 'task';
		}

		
		$.ajax({
	 		type: 'POST',
	 		url: '/delete',
	 		data:'deleteTitle='+deleteTitle+'&category='+category
	 	}); 
	});
});

</script>
<title>Search Result</title></head><body><table align='left' border='10' cellpadding='10'><caption>Search Result</caption><thead><tr><th><div align='left'>Title</div></th><th><div align='left'>Status</div></th><th><div align='left'>Priority</div></th><th><div align='left'>Owner</div></th><th>Deadline</div></th><th><div align='left'>Description</div></th><th><div align='left'>Delete</div></th></tr><tr><th bgcolor='#BEBEBE'>story for search</th><td bgcolor='#BEBEBE'>closed</td><td bgcolor='#BEBEBE'>low</td><td bgcolor='#BEBEBE'>111</td><td bgcolor='#BEBEBE'>Thu Oct 26 2017 00:00:00 GMT+0800 (CST)</td><td bgcolor='#BEBEBE'>story for search</td><th bgcolor='#BEBEBE'><button bgcolor='#BEBEBE' type='button' id='delete'>Delete</button></th></tr><tr><th>task3 for search_step3afterstep1andstep2</th><td>open</td><td>High</td><td>5555555555555</td><td>Thu Oct 26 2017 00:00:00 GMT+0800 (CST)</td><th></th><th><button type='button' id='delete'>Delete</button></th></tr><tr><th>task2 for search_step2afterstep1</th><td>open</td><td>low</td><td>null</td><td>Thu Oct 26 2017 00:00:00 GMT+0800 (CST)</td><th></th><th><button type='button' id='delete'>Delete</button></th></tr><tr><th>task1 for search_step1</th><td>open</td><td>High</td><td>null</td><td>Thu Oct 26 2017 00:00:00 GMT+0800 (CST)</td><th></th><th><button type='button' id='delete'>Delete</button></th></tr><tr><th bgcolor='#BEBEBE'>search record</th><td bgcolor='#BEBEBE'>open</td><td bgcolor='#BEBEBE'>low</td><td bgcolor='#BEBEBE'>null</td><td bgcolor='#BEBEBE'>Thu Oct 26 2017 00:00:00 GMT+0800 (CST)</td><td bgcolor='#BEBEBE'>blablablablabla...</td><th bgcolor='#BEBEBE'><button type='button' id='delete'>Delete</button></th></tr></thead></body></html>